document.addEventListener("DOMContentLoaded",(function(){const csvFilePath="csv/armor_data.csv";const iconFolderPath="icon/";function renderarmors(armor){const armorGrid=document.querySelector(".armor-grid");armorGrid.innerHTML="";armor.forEach((armor=>{const card=document.createElement("div");card.className="armor-card";const iconPath=`${iconFolderPath}${armor.invgfx}.gif`;const blessS=armor.bless;const blessSDisplay=blessS==0?`受祝福的 `:blessS==2?`受詛咒的 `:"";const professionMap={use_royal:"王族",use_knight:"騎士",use_mage:"法師",use_elf:"妖精",use_darkelf:"黑妖",use_dragonknight:"龍騎",use_illusionist:"幻術"};const allProfessions=Object.keys(professionMap);const professions=allProfessions.map((key=>armor[key]==="1"?professionMap[key]:"")).filter((name=>name));const allProfessionsDisplayed=allProfessions.every((key=>armor[key]==="1"));const professionDisplay=allProfessionsDisplayed?"全職業":professions.join(", ");const materialMap={iron:"鐵",steel:"金屬",wood:"木頭",leather:"皮",bone:"骨頭",gemstone:"寶石",mithril:"米索莉",blackmithril:"黑色米索莉",silver:"銀",oriharukon:"奧里哈魯根",platinum:"白金",dragonscale:"龍鱗",cloth:"布",vegetation:"植物",gold:"金",paper:"紙",copper:"銅"};const materialInChinese=materialMap[armor.material]||armor.material;const typeMap={helm:"頭盔",armor:"盔甲",cloak:"斗篷",T:"T恤",glove:"手套",boots:"長靴",shield:"盾牌",belt:"腰帶",amulet:"項鍊",ring:"戒指",earring:"耳環",guarder:"臂甲",aidl:"輔助",aidl2:"特殊"};const typeInChinese=typeMap[armor.type]||armor.type;const weightInKg=Math.round(parseFloat(armor.weight)/1e3);const greaterValue=parseInt(armor.greater,10);let greaterDisplay="";switch(greaterValue){case 3:greaterDisplay="等級: 特級<br>";break;case 2:greaterDisplay="等級: 中級<br>";break;case 1:greaterDisplay="等級: 初級<br>";break;case 0:greaterDisplay="等級: 高級<br>";break;case-1:greaterDisplay="";break;default:greaterDisplay=""}const minlvl=armor.min_lvl;const minlvlDisplay=minlvl&&minlvl>0?`裝備需求: Lv.${minlvl}<br>`:"";const acc=armor.ac;const accDisplay=acc&&acc!=="0"?`防禦: ${acc}<br>`:"";const dmgreduction=armor.damage_reduction;const dmgreductionDisplay=dmgreduction&&dmgreduction!=="0"?`<br>傷害減免: ${dmgreduction}`:"";const weightReduction=armor.weight_reduction*25;const weightReductionDisplay=weightReduction&&weightReduction!==0?`<br>負重: +${weightReduction}`:"";const addhitmodifier=armor.hit_modifier;const addhitmodifierDisplay=addhitmodifier&&addhitmodifier!=="0"?`<br>命中: ${addhitmodifier>0?"+":""}${addhitmodifier}`:"";const adddmgmodifier=armor.dmg_modifier;const adddmgmodifierDisplay=adddmgmodifier&&adddmgmodifier!=="0"?`<br>傷害: ${adddmgmodifier>0?"+":""}${adddmgmodifier}`:"";const addbowhitmodifier=armor.bow_hit_modifier;const addbowhitmodifierDisplay=addbowhitmodifier&&addbowhitmodifier!=="0"?`<br>遠距命中: ${addbowhitmodifier>0?"+":""}${addbowhitmodifier}`:"";const addbowdmgmodifier=armor.bow_dmg_modifier;const addbowdmgmodifierDisplay=addbowdmgmodifier&&addbowdmgmodifier!=="0"?`<br>遠距傷害: ${addbowdmgmodifier>0?"+":""}${addbowdmgmodifier}`:"";const addhp=armor.add_hp;const addhpDisplay=addhp&&addhp!=="0"?`<br>血量: ${addhp>0?"+":""}${addhp}`:"";const addmp=armor.add_mp;const addmpDisplay=addmp&&addmp!=="0"?`<br>魔力: ${addmp>0?"+":""}${addmp}`:"";const addhpr=armor.add_hpr;const addhprDisplay=addhpr&&addhpr!=="0"?`<br>回血: ${addhpr>0?"+":""}${addhpr}`:"";const addmpr=armor.add_mpr;const addmprDisplay=addmpr&&addmpr!=="0"?`<br>回魔: ${addmpr>0?"+":""}${addmpr}`:"";const addsp=armor.add_sp;const addspDisplay=addsp&&addsp!=="0"?`<br>魔攻: ${addsp>0?"+":""}${addsp}`:"";const addm_def=armor.m_def;const addm_defDisplay=addm_def&&addm_def!=="0"?`<br>魔防: ${addm_def>0?"+":""}${addm_def}`:"";const addStr=armor.add_str;const addStrDisplay=addStr&&addStr!=="0"?`<br>力量 +${addStr}`:"";const addCon=armor.add_con;const addConDisplay=addCon&&addCon!=="0"?`<br>體質 +${addCon}`:"";const addDex=armor.add_dex;const addDexDisplay=addDex&&addDex!=="0"?`<br>敏捷 +${addDex}`:"";const addInt=armor.add_int;const addIntDisplay=addInt&&addInt!=="0"?`<br>智力 +${addInt}`:"";const addWis=armor.add_wis;const addWisDisplay=addWis&&addWis!=="0"?`<br>精神 +${addWis}`:"";const addCha=armor.add_cha;const addChaDisplay=addCha&&addCha!=="0"?`<br>魅力 +${addCha}`:"";const defenseWater=armor.defense_water;const defenseWaterDisplay=defenseWater&&defenseWater!=="0"?`<br>水屬性防禦: +${defenseWater}`:"";const defenseWind=armor.defense_wind;const defenseWindDisplay=defenseWind&&defenseWind!=="0"?`<br>風屬性防禦: +${defenseWind}`:"";const defenseFire=armor.defense_fire;const defenseFireDisplay=defenseFire&&defenseFire!=="0"?`<br>火屬性防禦: +${defenseFire}`:"";const defenseEarth=armor.defense_earth;const defenseEarthDisplay=defenseEarth&&defenseEarth!=="0"?`<br>地屬性防禦: +${defenseEarth}`:"";const registStun=armor.regist_stun;const registStunDisplay=registStun&&registStun!=="0"?`<br>昏迷耐性: +${registStun}`:"";const registStone=armor.regist_stone;const registStoneDisplay=registStone&&registStone!=="0"?`<br>石化耐性: +${registStone}`:"";const registSleep=armor.regist_sleep;const registSleepDisplay=registSleep&&registSleep!=="0"?`<br>睡眠耐性: +${registSleep}`:"";const registFreeze=armor.regist_freeze;const registFreezeDisplay=registFreeze&&registFreeze!=="0"?`<br>寒冰耐性: +${registFreeze}`:"";const registSustain=armor.regist_sustain;const registSustainDisplay=registSustain&&registSustain!=="0"?`<br>支撐耐性: +${registSustain}`:"";const registBlind=armor.regist_blind;const registBlindDisplay=registBlind&&registBlind!=="0"?`<br>闇黑耐性: +${registBlind}`:"";const hasteMap={0:"",1:"<br>1段加速"};const hasteDisplay=hasteMap[armor.haste_item]||"";const canbedmgMap={0:"<br>不會損壞",1:""};const canbedmgDisplay=canbedmgMap[armor.canbedmg]||"";const tradeable=armor.trade;const tradeableDisplay=tradeable&&tradeable>0?`<br>不可轉移`:"";const deleteable=armor.cant_delete;const deleteableDisplay=deleteable&&deleteable>0?`<br>不可刪除`:"";card.innerHTML=`\n                <div class="armor-card-content">\n                    <div class="armor-icon">\n                        <img src="${iconPath}" alt="${armor.name}">\n                    </div>\n                    <div class="armor-name">${blessSDisplay}${armor.name}</div>\n                </div>\n                <div class="armor-stats">\n\t\t\t\t\t${minlvlDisplay}\n                    可用: ${professionDisplay} <br>\n\t\t\t\t\t類型: ${typeInChinese} <br>\n\t\t\t\t\t材質: ${materialInChinese} <br>\n                    重量: ${weightInKg} <br>\n\t\t\t\t\t${greaterDisplay}\n\t\t\t\t\t${accDisplay}\n                    安定: ${armor.safenchant}\n\t\t\t\t\t${dmgreductionDisplay}\n\t\t\t\t\t${weightReductionDisplay}\n\t\t\t\t\t${addhitmodifierDisplay}\n\t\t\t\t\t${adddmgmodifierDisplay}\n\t\t\t\t\t${addbowhitmodifierDisplay}\n\t\t\t\t\t${addbowdmgmodifierDisplay}\n\t\t\t\t\t${addhpDisplay}\n\t\t\t\t\t${addmpDisplay}\n\t\t\t\t\t${addhprDisplay}\n\t\t\t\t\t${addmprDisplay}\n\t\t\t\t\t${addspDisplay}\n\t\t\t\t\t${addm_defDisplay}\n\t\t\t\t\t${addStrDisplay}\n\t\t\t\t\t${addConDisplay}\n\t\t\t\t\t${addDexDisplay}\n\t\t\t\t\t${addIntDisplay}\n\t\t\t\t\t${addWisDisplay}\n\t\t\t\t\t${addChaDisplay}\n\t\t\t\t\t${defenseEarthDisplay}\n\t\t\t\t\t${defenseWaterDisplay}\t\t\t\t\t\n\t\t\t\t\t${defenseFireDisplay}\n\t\t\t\t\t${defenseWindDisplay}\n\t\t\t\t\t${registStunDisplay}\n\t\t\t\t\t${registStoneDisplay}\n\t\t\t\t\t${registSleepDisplay}\n\t\t\t\t\t${registFreezeDisplay}\n\t\t\t\t\t${registSustainDisplay}\n\t\t\t\t\t${registBlindDisplay}\n\t\t\t\t\t${tradeableDisplay||deleteableDisplay||armor.note&&armor.note.trim()!==""?`<br>備註:`:""}\n\t\t\t\t\t${tradeableDisplay}\n\t\t\t\t\t${deleteableDisplay}\n\t\t\t\t\t${armor.note&&armor.note.trim()!==""?`<br>${armor.note}`:""}\n                </div>\n            `;card.dataset.type=armor.type;armorGrid.appendChild(card)}))}fetch(csvFilePath).then((response=>{if(!response.ok)throw new Error("Network response was not ok");return response.text()})).then((csvText=>{const rows=csvText.trim().split("\n");const headers=rows[0].split(",");const armors=rows.slice(1).map((row=>{const values=row.split(",");let armor={};headers.forEach(((header,index)=>{armor[header.replace(/"/g,"")]=values[index].replace(/"/g,"")}));return armor}));renderarmors(armors)})).catch((error=>{console.error("Error fetching or parsing CSV file:",error)}));const searchButton=document.querySelector(".search-bar button");const searchInput=document.querySelector(".search-bar input");searchButton.addEventListener("click",(function(){const searchTerm=searchInput.value.toLowerCase();const armorCards=document.querySelectorAll(".armor-card");armorCards.forEach((card=>{const armorName=card.querySelector(".armor-name").textContent.toLowerCase();if(armorName.includes(searchTerm)){card.style.display="block"}else{card.style.display="none"}}))}));const categoryButtons=document.querySelectorAll(".category-btn");categoryButtons.forEach((button=>{button.addEventListener("click",(function(){const type=this.textContent;const armorCards=document.querySelectorAll(".armor-card");armorCards.forEach((card=>{const armorType=card.querySelector(".armor-stats").textContent.includes(`類型: ${type}`);if(type==="所有"||armorType){card.style.display="block"}else{card.style.display="none"}}))}))}))}));