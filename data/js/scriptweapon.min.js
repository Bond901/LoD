document.addEventListener("DOMContentLoaded",(function(){const csvFilePath="csv/weapon_data.csv";const iconFolderPath="icon/";function renderWeapons(weapons){const weaponGrid=document.querySelector(".weapon-grid");weaponGrid.innerHTML="";weapons.forEach((weapon=>{const card=document.createElement("div");card.className="weapon-card";const iconPath=`${iconFolderPath}${weapon.invgfx}.gif`;const blessS=weapon.bless;const blessSDisplay=blessS==0?`受祝福的 `:blessS==2?`受詛咒的 `:"";const professionMap={use_royal:"王族",use_knight:"騎士",use_mage:"法師",use_elf:"妖精",use_darkelf:"黑妖",use_dragonknight:"龍騎",use_illusionist:"幻術"};const allProfessions=Object.keys(professionMap);const professions=allProfessions.map((key=>weapon[key]==="1"?professionMap[key]:"")).filter((name=>name));const allProfessionsDisplayed=allProfessions.every((key=>weapon[key]==="1"));const professionDisplay=allProfessionsDisplayed?"全職業":professions.join(", ");const materialMap={iron:"鐵",steel:"金屬",wood:"木頭",leather:"皮",bone:"骨頭",gemstone:"寶石",mithril:"米索莉",blackmithril:"黑色米索莉",silver:"銀",oriharukon:"奧里哈魯根",platinum:"白金",gold:"金"};const materialInChinese=materialMap[weapon.material]||weapon.material;const typeMap={dagger:"匕首",sword:"劍",tohandsword:"雙手劍",bow:"弓",singlebow:"單手弓",staff:"魔杖",tohandstaff:"雙手杖",claw:"鋼爪",edoryu:"雙刀",kiringku:"奇古獸",chainsword:"鎖鏈劍",blunt:"斧錘",tohandblunt:"雙手斧錘",spear:"矛",singlespear:"單手矛",gauntlet:"手甲"};const typeInChinese=typeMap[weapon.type]||weapon.type;const weightInKg=Math.round(parseFloat(weapon.weight)/1e3);const doubledmg=weapon.double_dmg_chance;const doubledmgDisplay=doubledmg&&doubledmg>0?`爆擊: ${doubledmg}%<br>`:"";const minlvl=weapon.min_lvl;const minlvlDisplay=minlvl&&minlvl>0?`等級: ${minlvl}<br>`:"";const addhitmodifier=weapon.hitmodifier;const addhitmodifierDisplay=addhitmodifier&&addhitmodifier!=="0"?`<br>命中: ${addhitmodifier>0?"+":""}${addhitmodifier}`:"";const adddmgmodifier=weapon.dmgmodifier;const adddmgmodifierDisplay=adddmgmodifier&&adddmgmodifier!=="0"?`<br>傷害: ${adddmgmodifier>0?"+":""}${adddmgmodifier}`:"";const addhp=weapon.add_hp;const addhpDisplay=addhp&&addhp!=="0"?`<br>血量: ${addhp>0?"+":""}${addhp}`:"";const addmp=weapon.add_mp;const addmpDisplay=addmp&&addmp!=="0"?`<br>魔力: ${addmp>0?"+":""}${addmp}`:"";const addhpr=weapon.add_hpr;const addhprDisplay=addhpr&&addhpr!=="0"?`<br>回血: ${addhpr>0?"+":""}${addhpr}`:"";const addmpr=weapon.add_mpr;const addmprDisplay=addmpr&&addmpr!=="0"?`<br>回魔: ${addmpr>0?"+":""}${addmpr}`:"";const addsp=weapon.add_sp;const addspDisplay=addsp&&addsp!=="0"?`<br>魔攻: ${addsp>0?"+":""}${addsp}`:"";const addm_def=weapon.m_def;const addm_defDisplay=addm_def&&addm_def!=="0"?`<br>魔防: ${addm_def>0?"+":""}${addm_def}`:"";const addStr=weapon.add_str;const addStrDisplay=addStr&&addStr!=="0"?`<br>力量 +${addStr}`:"";const addCon=weapon.add_con;const addConDisplay=addCon&&addCon!=="0"?`<br>體質 +${addCon}`:"";const addDex=weapon.add_dex;const addDexDisplay=addDex&&addDex!=="0"?`<br>敏捷 +${addDex}`:"";const addInt=weapon.add_int;const addIntDisplay=addInt&&addInt!=="0"?`<br>智力 +${addInt}`:"";const addWis=weapon.add_wis;const addWisDisplay=addWis&&addWis!=="0"?`<br>精神 +${addWis}`:"";const addCha=weapon.add_cha;const addChaDisplay=addCha&&addCha!=="0"?`<br>魅力 +${addCha}`:"";const usetime=parseInt(weapon.max_use_time,10);let usetimeDisplay="";if(!isNaN(usetime)&&usetime>0){const days=Math.floor(usetime/86400);const hours=Math.floor(usetime%86400/3600);const minutes=Math.floor(usetime%3600/60);const seconds=usetime%60;let timeStr="";if(days>0)timeStr+=`${days}天 `;if(hours>0)timeStr+=`${hours}小時 `;if(minutes>0)timeStr+=`${minutes}分鐘 `;if(seconds>0)timeStr+=`${seconds}秒`;usetimeDisplay=`<br>使用時限${timeStr.trim()}`}const hasteMap={0:"",1:"<br>人物速度 x1.33"};const hasteDisplay=hasteMap[weapon.haste_item]||"";const canbedmgMap={0:"<br>不會損壞",1:""};const canbedmgDisplay=canbedmgMap[weapon.canbedmg]||"";const tradeable=weapon.trade;const tradeableDisplay=tradeable&&tradeable>0?`<br>不可轉移`:"";const deleteable=weapon.cant_delete;const deleteableDisplay=deleteable&&deleteable>0?`<br>不可刪除`:"";card.innerHTML=`\n                <div class="weapon-card-content">\n                    <div class="weapon-icon">\n                        <img src="${iconPath}" alt="${weapon.name}">\n                    </div>\n                    <div class="weapon-name">${blessSDisplay}${weapon.name}</div>\n                </div>\n                <div class="weapon-stats">\n                    可用: ${professionDisplay} <br>\n\t\t\t\t\t類型: ${typeInChinese} <br>\n\t\t\t\t\t${doubledmgDisplay}\n\t\t\t\t\t材質: ${materialInChinese} <br>\n                    重量: ${weightInKg} <br>\n\t\t\t\t\t${minlvlDisplay}\n                    攻擊: ${weapon.dmg_small} / ${weapon.dmg_large} <br>\n                    安定: ${weapon.safenchant}\n\t\t\t\t\t${addhitmodifierDisplay}\n\t\t\t\t\t${adddmgmodifierDisplay}\n\t\t\t\t\t${addhpDisplay}\n\t\t\t\t\t${addmpDisplay}\n\t\t\t\t\t${addhprDisplay}\n\t\t\t\t\t${addmprDisplay}\n\t\t\t\t\t${addspDisplay}\n\t\t\t\t\t${addm_defDisplay}\n\t\t\t\t\t${addStrDisplay}\n\t\t\t\t\t${addConDisplay}\n\t\t\t\t\t${addDexDisplay}\n\t\t\t\t\t${addIntDisplay}\n\t\t\t\t\t${addWisDisplay}\n\t\t\t\t\t${addChaDisplay}\t\n\t\t\t\t\t${usetimeDisplay||tradeableDisplay||deleteableDisplay||hasteDisplay||weapon.note&&weapon.note.trim()!==""?`<br>備註:`:""}\n\t\t\t\t\t${usetimeDisplay}\n\t\t\t\t\t${tradeableDisplay}\n\t\t\t\t\t${deleteableDisplay}\n\t\t\t\t\t${hasteDisplay}\n\t\t\t\t\t${canbedmgDisplay}\n\t\t\t\t\t${weapon.note&&weapon.note.trim()!==""?`<br>備註:<br>${weapon.note}`:""}\n                </div>\n            `;card.dataset.type=weapon.type;weaponGrid.appendChild(card)}))}fetch(csvFilePath).then((response=>{if(!response.ok)throw new Error("Network response was not ok");return response.text()})).then((csvText=>{const rows=csvText.trim().split("\n");const headers=rows[0].split(",");const weapons=rows.slice(1).map((row=>{const values=row.split(",");let weapon={};headers.forEach(((header,index)=>{weapon[header.replace(/"/g,"")]=values[index].replace(/"/g,"")}));return weapon}));renderWeapons(weapons)})).catch((error=>{console.error("Error fetching or parsing CSV file:",error)}));const searchButton=document.querySelector(".search-bar button");const searchInput=document.querySelector(".search-bar input");searchButton.addEventListener("click",(function(){const searchTerm=searchInput.value.toLowerCase();const weaponCards=document.querySelectorAll(".weapon-card");weaponCards.forEach((card=>{const weaponName=card.querySelector(".weapon-name").textContent.toLowerCase();if(weaponName.includes(searchTerm)){card.style.display="block"}else{card.style.display="none"}}))}));const categoryButtons=document.querySelectorAll(".category-btn");categoryButtons.forEach((button=>{button.addEventListener("click",(function(){const type=this.textContent;const weaponCards=document.querySelectorAll(".weapon-card");weaponCards.forEach((card=>{const weaponType=card.querySelector(".weapon-stats").textContent.includes(`類型: ${type}`);if(type==="所有"||weaponType){card.style.display="block"}else{card.style.display="none"}}))}))}))}));